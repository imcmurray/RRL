{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3">Dashboard</h1>
        <p class="text-muted">Welcome to Rinse Repeat Labs command center</p>
    </div>
</div>

<!-- Stats Cards (HTMX auto-refresh every 30s) -->
<div class="row mb-4" id="dashboard-stats"
     hx-get="{{ url_for('htmx_dashboard_stats') }}"
     hx-trigger="every 30s"
     hx-swap="innerHTML">
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stats-card">
            <div class="card-body d-flex align-items-center">
                <div class="stat-icon text-primary me-3">
                    <i class="bi bi-lightbulb"></i>
                </div>
                <div>
                    <div class="stat-value" id="ideas-count">{{ ideas_count }}</div>
                    <div class="stat-label">Ideas</div>
                    <small class="text-muted">{{ ideas_pending + ideas_review }} pending review</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stats-card">
            <div class="card-body d-flex align-items-center">
                <div class="stat-icon text-success me-3">
                    <i class="bi bi-people"></i>
                </div>
                <div>
                    <div class="stat-value" id="testers-count">{{ testers_active }}</div>
                    <div class="stat-label">Active Testers</div>
                    <small class="text-muted">{{ testers_count }} total</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stats-card">
            <div class="card-body d-flex align-items-center">
                <div class="stat-icon text-info me-3">
                    <i class="bi bi-kanban"></i>
                </div>
                <div>
                    <div class="stat-value" id="projects-count">{{ active_projects | length }}</div>
                    <div class="stat-label">Active Projects</div>
                    <small class="text-muted">{{ projects_count }} total</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stats-card">
            <div class="card-body d-flex align-items-center">
                <div class="stat-icon text-warning me-3">
                    <i class="bi bi-currency-dollar"></i>
                </div>
                <div>
                    <div class="stat-value" id="revenue-total">{{ outstanding_amount | currency }}</div>
                    <div class="stat-label">Outstanding</div>
                    <small class="text-muted">{{ clients_count }} clients</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mb-4">
    <div class="col-12">
        <h5>Quick Actions</h5>
    </div>
    <div class="col-lg-2 col-md-4 col-6 mb-3">
        <a href="{{ url_for('ideas_new') }}" class="quick-action">
            <i class="bi bi-plus-circle text-primary"></i>
            <span>New Idea</span>
        </a>
    </div>
    <div class="col-lg-2 col-md-4 col-6 mb-3">
        <a href="{{ url_for('testers_new') }}" class="quick-action">
            <i class="bi bi-person-plus text-success"></i>
            <span>Add Tester</span>
        </a>
    </div>
    <div class="col-lg-2 col-md-4 col-6 mb-3">
        <a href="{{ url_for('projects_new') }}" class="quick-action">
            <i class="bi bi-folder-plus text-info"></i>
            <span>New Project</span>
        </a>
    </div>
    <div class="col-lg-2 col-md-4 col-6 mb-3">
        <a href="{{ url_for('reports_generate') }}" class="quick-action">
            <i class="bi bi-file-earmark-bar-graph text-warning"></i>
            <span>Generate Report</span>
        </a>
    </div>
    <div class="col-lg-2 col-md-4 col-6 mb-3">
        <a href="{{ url_for('finances_invoice_new') }}" class="quick-action">
            <i class="bi bi-receipt text-danger"></i>
            <span>New Invoice</span>
        </a>
    </div>
    <div class="col-lg-2 col-md-4 col-6 mb-3">
        <a href="{{ url_for('meetings_list') }}" class="quick-action">
            <i class="bi bi-camera-video text-secondary"></i>
            <span>Meetings</span>
        </a>
    </div>
</div>

<div class="row">
    <!-- Recent Ideas -->
    <div class="col-lg-6 mb-4">
        <div class="card content-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5><i class="bi bi-lightbulb me-2"></i>Recent Ideas</h5>
                <a href="{{ url_for('ideas_list') }}" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Status</th>
                                <th>Submitted</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for idea in recent_ideas %}
                            <tr>
                                <td>
                                    <a href="{{ url_for('ideas_detail', idea_id=idea.id) }}">{{ idea.name }}</a>
                                </td>
                                <td><span class="badge badge-status badge-{{ idea.status }}">{{ idea.status | replace('_', ' ') | title }}</span></td>
                                <td>{{ idea.created_at | datetime }}</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="3" class="text-center text-muted py-4">No ideas yet</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Projects -->
    <div class="col-lg-6 mb-4">
        <div class="card content-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5><i class="bi bi-kanban me-2"></i>Active Projects</h5>
                <a href="{{ url_for('projects_list') }}" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Project</th>
                                <th>Client</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for project in active_projects %}
                            <tr>
                                <td>
                                    <a href="{{ url_for('projects_detail', project_id=project.id) }}">{{ project.name }}</a>
                                </td>
                                <td>{{ project.client_name or 'Internal' }}</td>
                                <td><span class="badge badge-status badge-{{ project.status }}">{{ project.status | title }}</span></td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="3" class="text-center text-muted py-4">No active projects</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Recent Testers -->
    <div class="col-lg-6 mb-4">
        <div class="card content-card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5><i class="bi bi-people me-2"></i>Recent Testers</h5>
                <a href="{{ url_for('testers_list') }}" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Status</th>
                                <th>Devices</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for tester in recent_testers %}
                            <tr>
                                <td>
                                    <a href="{{ url_for('testers_detail', tester_id=tester.id) }}">{{ tester.name }}</a>
                                </td>
                                <td><span class="badge badge-status badge-{{ tester.status }}">{{ tester.status | title }}</span></td>
                                <td>{{ tester.devices | join(', ') if tester.devices else 'N/A' }}</td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="3" class="text-center text-muted py-4">No testers yet</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Agent Team -->
    <div class="col-lg-6 mb-4">
        <div class="card content-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5><i class="bi bi-robot me-2"></i>AI Agent Team</h5>
                <a href="{{ url_for('agents_list') }}" class="btn btn-sm btn-outline-primary">All Portals</a>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <h6 class="text-muted mb-2">Executive Team</h6>
                    <a href="{{ url_for('agent_portal', agent_id='ceo') }}" class="agent-badge agent-ceo me-1 mb-1 text-decoration-none">CEO</a>
                    <a href="{{ url_for('agent_portal', agent_id='cfo') }}" class="agent-badge agent-cfo me-1 mb-1 text-decoration-none">CFO</a>
                    <a href="{{ url_for('agent_portal', agent_id='cito') }}" class="agent-badge agent-cito me-1 mb-1 text-decoration-none">CITO</a>
                    <a href="{{ url_for('agent_portal', agent_id='sales') }}" class="agent-badge agent-sales me-1 mb-1 text-decoration-none">Sales</a>
                    <a href="{{ url_for('agent_portal', agent_id='legal') }}" class="agent-badge agent-legal me-1 mb-1 text-decoration-none">Legal</a>
                </div>
                <div class="mb-3">
                    <h6 class="text-muted mb-2">Product & Engineering</h6>
                    <a href="{{ url_for('agent_portal', agent_id='dev_lead') }}" class="agent-badge agent-dev_lead me-1 mb-1 text-decoration-none">Dev Lead</a>
                    <a href="{{ url_for('agent_portal', agent_id='design_lead') }}" class="agent-badge agent-design_lead me-1 mb-1 text-decoration-none">Design Lead</a>
                    <a href="{{ url_for('agent_portal', agent_id='qa_lead') }}" class="agent-badge agent-qa_lead me-1 mb-1 text-decoration-none">QA Lead</a>
                </div>
                <div>
                    <h6 class="text-muted mb-2">Operations</h6>
                    <a href="{{ url_for('agent_portal', agent_id='pm') }}" class="agent-badge agent-pm me-1 mb-1 text-decoration-none">PM</a>
                    <a href="{{ url_for('agent_portal', agent_id='customer_success') }}" class="agent-badge agent-customer_success me-1 mb-1 text-decoration-none">Customer Success</a>
                    <a href="{{ url_for('agent_portal', agent_id='marketing') }}" class="agent-badge agent-marketing me-1 mb-1 text-decoration-none">Marketing</a>
                    <a href="{{ url_for('agent_portal', agent_id='support') }}" class="agent-badge agent-support me-1 mb-1 text-decoration-none">Support</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Start a Meeting -->
    <div class="col-lg-6 mb-4">
        <div class="card content-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5><i class="bi bi-people me-2"></i>Start a Meeting</h5>
                <a href="{{ url_for('group_meetings_list') }}" class="btn btn-sm btn-outline-primary">History</a>
            </div>
            <div class="card-body">
                <p class="text-muted small mb-3">Get perspectives from multiple AI agents at once</p>

                <div class="d-grid gap-2">
                    <a href="{{ url_for('group_meeting_new', preset='exec') }}" class="btn btn-outline-primary text-start">
                        <i class="bi bi-briefcase me-2"></i>
                        <strong>Executive Meeting</strong>
                        <small class="d-block text-muted">CEO, CFO, CITO, Sales, Legal</small>
                    </a>
                    <a href="{{ url_for('group_meeting_new', preset='tech') }}" class="btn btn-outline-info text-start">
                        <i class="bi bi-code-slash me-2"></i>
                        <strong>Technical Meeting</strong>
                        <small class="d-block text-muted">CITO, Dev Lead, Design Lead, QA Lead</small>
                    </a>
                    <a href="{{ url_for('group_meeting_new', preset='all_hands') }}" class="btn btn-outline-success text-start">
                        <i class="bi bi-megaphone me-2"></i>
                        <strong>All-Hands Meeting</strong>
                        <small class="d-block text-muted">All 12 agents</small>
                    </a>
                    <a href="{{ url_for('group_meeting_new') }}" class="btn btn-outline-secondary text-start">
                        <i class="bi bi-gear me-2"></i>
                        <strong>Custom Meeting</strong>
                        <small class="d-block text-muted">Choose your own agents</small>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
