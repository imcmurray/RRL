{% extends "base.html" %}

{% block title %}Payments{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-6">
        <h1 class="h3">Payments</h1>
        <p class="text-muted">Track income and expense payments</p>
    </div>
    <div class="col-md-6 text-end">
        <a href="{{ url_for('finances_payment_new') }}" class="btn btn-success">
            <i class="bi bi-cash-stack me-1"></i>Record Payment
        </a>
        <a href="{{ url_for('finances_expense_new') }}" class="btn btn-outline-danger">
            <i class="bi bi-wallet2 me-1"></i>Add Expense
        </a>
    </div>
</div>

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-md-4 mb-3">
        <div class="card stats-card bg-success text-white">
            <div class="card-body finance-metric">
                <div class="value">{{ total_income | currency }}</div>
                <div class="label">Total Income</div>
            </div>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="card stats-card bg-danger text-white">
            <div class="card-body finance-metric">
                <div class="value">{{ total_expenses | currency }}</div>
                <div class="label">Total Expenses</div>
            </div>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="card stats-card bg-primary text-white">
            <div class="card-body finance-metric">
                <div class="value">{{ (total_income - total_expenses) | currency }}</div>
                <div class="label">Net Balance</div>
            </div>
        </div>
    </div>
</div>

<!-- Payments Table -->
<div class="table-container">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Description</th>
                <th>Client/Vendor</th>
                <th>Invoice</th>
                <th>Amount</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for payment in payments %}
            <tr>
                <td>{{ payment.date | datetime }}</td>
                <td>
                    <span class="badge bg-{{ 'success' if payment.type == 'income' else 'danger' }}">
                        {{ payment.type | title }}
                    </span>
                </td>
                <td>{{ payment.description or '-' }}</td>
                <td>{{ payment.client_name or payment.vendor or '-' }}</td>
                <td>
                    {% if payment.invoice_id %}
                    <a href="{{ url_for('finances_invoice_detail', invoice_id=payment.invoice_id) }}">
                        {{ payment.invoice_number or payment.invoice_id[:8] }}
                    </a>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td class="{{ 'text-success' if payment.type == 'income' else 'text-danger' }}">
                    {{ '+' if payment.type == 'income' else '-' }}{{ payment.amount | currency }}
                </td>
                <td>
                    <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="tooltip" title="View details">
                        <i class="bi bi-eye"></i>
                    </button>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="text-center py-5">
                    <i class="bi bi-cash display-4 text-muted"></i>
                    <p class="text-muted mt-2">No payments recorded</p>
                    <a href="{{ url_for('finances_payment_new') }}" class="btn btn-success">Record First Payment</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
